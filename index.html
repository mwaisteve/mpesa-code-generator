<!DOCTYPE html>
<html lang="en">
<head>
      <meta charset="UTF-8">
      <title>M-Pesa Code Generator</title>
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
      <style>
body {
      background-color: #f8f9fa;
      padding-top: 50px;
}
.container {
      max-width: 500px;
}
.code-box {
      font-family: monospace;
      font-size: 1.5rem;
      margin-top: 20px;
      padding: 10px;
      background: #e9ecef;
      border-radius: 8px;
      text-align: center;
}
      </style>
</head>
<body>
      <div class="container text-center">
<h2 class="mb-4">M-Pesa Transaction Code Generator</h2>
<form id="mpesaForm">
      <div class="mb-3">
<label for="transDate" class="form-label">Select Transaction Date:</label>
<input type="date" id="transDate" class="form-control" required>
      </div>
      <button type="submit" class="btn btn-success">Generate Code</button>
</form>
<div id="codeOutput" class="code-box d-none"></div>
      </div>

      <script>
const yearMap = "ABCDEFGHIJKLMNOPQRSTUVWXYZ"; // A = 2006, T = 2025
const monthMap = { 0: "A", 1: "B", 2: "C", 3: "D", 4: "E", 5: "F", 6: "G", 7: "H", 8: "I", 9: "J", 10: "K", 11: "L" };
const dayMap = {
      1: "1", 2: "2", 3: "3", 4: "4", 5: "5", 6: "6", 7: "7", 8: "8", 9: "9", 10: "A",
      11: "B", 12: "C", 13: "D", 14: "E", 15: "F", 16: "G", 17: "H", 18: "I", 19: "J", 20: "K",
      21: "L", 22: "M", 23: "N", 24: "O", 25: "P", 26: "Q", 27: "R", 28: "S", 29: "T", 30: "U", 31: "V"
};

    // New character sets for the modified logic
    const numericChars = "0123456789";
    const alphanumericChars = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";

function getYearLetter(year) {
      const baseYear = 2006;
      return yearMap[year - baseYear] || "Z";
}

    // Updated getRandomChar function to use specified character sets
    function getRandomChar(charSet) {
      return charSet.charAt(Math.floor(Math.random() * charSet.length));
    }

document.getElementById("mpesaForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const dateInput = document.getElementById("transDate").value;
      if (!dateInput) return;

      const date = new Date(dateInput);
      const yearLetter = getYearLetter(date.getFullYear());
      const monthLetter = monthMap[date.getMonth()];
      const dayLetter = dayMap[date.getDate()];

      // Generate the 4th character (a number 0-9)
      const fourthChar = getRandomChar(numericChars);

      // Generate the remaining 6 random alphanumeric characters
      let remainingSixChars = "";
      for (let i = 0; i < 6; i++) {
        remainingSixChars += getRandomChar(alphanumericChars);
      }
      
      const code = `${yearLetter}${monthLetter}${dayLetter}${fourthChar}${remainingSixChars}`;

      const output = document.getElementById("codeOutput");
      output.textContent = code;
      output.classList.remove("d-none");
});
      </script>
</body>
</html>